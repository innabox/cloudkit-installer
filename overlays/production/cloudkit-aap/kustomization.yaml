apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: cloudkit-aap-production

resources:
- ../../../base/cloudkit-aap

# Production naming convention
namePrefix: prod-

# Production environment annotations
commonAnnotations:
  environment: production

labels:
- includeSelectors: true
  pairs:
    environment: production
    app.kubernetes.io/managed-by: kustomize

patches:
- patch: |-
    - op: replace
      path: /stringData/vars.yaml
      value: |-
        ---
        aap_hostname: aap.prod.example.com
        aap_username: "{{ lookup('env', 'AAP_USERNAME') }}"
        aap_password: "{{ lookup('env', 'AAP_PASSWORD') }}"
        aap_organization_name: prod-cloudkit
        aap_project_name: cloudkit-aap-prod
        aap_project_git_uri: https://github.com/organization/cloudkit-aap.git
        aap_project_git_branch: main
        aap_ee_image: quay.io/organization/cloudkit-aap-ee:latest
        aap_validate_certs: true
        license_manifest_path: "{{ lookup('env', 'LICENSE_MANIFEST_PATH') }}"
  target:
    kind: Secret
    name: config-as-code-ig
- patch: |-
    - op: replace
      path: /data/license.zip
      value: ""
  target:
    kind: Secret
    name: config-as-code-ig
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: quay.io/organization/cloudkit-aap-ee:latest
  target:
    kind: Job
    name: aap-bootstrap
- path: fix-ansibleautomationplatform.yaml
  target:
    kind: AnsibleAutomationPlatform
    name: prod-cloudkit